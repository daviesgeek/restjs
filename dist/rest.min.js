"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol?"symbol":typeof e};var Rest={};Rest.Config={headers:[],responseType:"json",fields:{id:"id"},baseUrl:""};Rest.Config.set=function(e){Object.assign(Rest.Config,e)};Rest._responseInterceptors=[];Rest.addResponseInterceptor=function(e){Rest._responseInterceptors.push(e)};Rest._responseExtractors=[];Rest.addResponseExtractor=function(e){Rest._responseExtractors.push(e)};Rest.factory=function(e,t,n){var r=arguments.length<=3||arguments[3]===undefined?null:arguments[3];var s=Object.create(Factory,{route:{configurable:false,enumerable:false,value:e.replace(/^\/|\/$/g,"")},config:{configurable:false,enumerable:false,value:r||Rest.Config},elementTransformer:{configurable:false,enumerable:false,value:n}});var o=(typeof t==="undefined"?"undefined":_typeof(t))=="object"?t:{};Object.assign(s,o);if(typeof t=="function")s=t(s);return s};Rest._makeRequest=function(e,t,n){var r=arguments.length<=3||arguments[3]===undefined?{}:arguments[3];var s=arguments[4];var o=arguments[5];var i=new Promise(function(i,a){var f=new XMLHttpRequest;if("timeout"in e)f.timeout=e.timeout;f.withCredentials=e.withCredentials;f.responseType=e.responseType;f.onreadystatechange=function(){var t=f.response;if(f.readyState==XMLHttpRequest.DONE){Rest._responseInterceptors.forEach(function(e){e(t,f.responseType,n,f.responseURL,a)});Rest._responseExtractors.forEach(function(e){t=e(t)});if(f.status<200||f.status>299)return a();if(t&&Object.keys(t).length)i(Rest._restify(t,s,e));else i(null)}};f.open(t,Rest._createUrl(n,r),true);f.setRequestHeader("Content-type","application/json");e.headers.forEach(function(e){f.setRequestHeader(e[0],e[1])});if(o&&f.responseType=="json")return f.send(JSON.stringify(o));else return f.send(o)});return i};Rest._createUrl=function(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var n=Rest.Config.baseUrl.replace(/\/+$/,"");var r=Object.keys(t).reduce(function(e,n){e.push(n+"="+encodeURIComponent(t[n]));return e},[]).join("&");return n+"/"+e+(r?"?"+r:"")};Rest._restify=function(e,t,n){if(Array.isArray(e)){return e.reduce(function(e,r){e.push(Rest._restify(r,t,n));return e},[])}return t.create.call(t,e,true)};var Factory=function e(){};Factory.create=function(e){var t=arguments.length<=1||arguments[1]===undefined?false:arguments[1];var n=Object.create(Element,{route:{configurable:false,enumerable:false,value:this.route},fromServer:{configurable:true,enumerable:false,value:t},config:{configurable:false,enumerable:false,value:this.config},factory:{configurable:false,enumerable:false,value:this}});var r=_typeof(this.elementTransformer)=="object"?this.elementTransformer:{};Object.assign(n,e,r);if(typeof this.elementTransformer=="function")n=this.elementTransformer(e);return n};Factory.getList=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return Rest._makeRequest(this.config,"GET",this.route,e,this,null)};Factory.get=function(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return Rest._makeRequest(this.config,"GET",this.route+("/"+e),t,this,null)};var Element={};Element.get=function(e){return Rest._makeRequest(this.config,"GET",this.route+("/"+this[this.config.fields.id]),e,this.factory,null)};Element.post=function(e){return Rest._makeRequest(this.config,"POST",this.route+(this.fromServer?"/"+this[this.config.fields.id]:""),e,this.factory,this)};Element.patch=function(){var e=Rest._findBodyAndParams(arguments,this);var t=e.body;var n=e.params;return Rest._makeRequest(this.config,"PATCH",this.route+("/"+this[this.config.fields.id]),n,this.factory,t)};Element.put=function(e){return Rest._makeRequest(this.config,"PUT",this.route+("/"+this[this.config.fields.id]),e,this.factory,this)};Rest._findBodyAndParams=function(e,t){var n={},r=void 0;if(e[0]instanceof Array){e[0].forEach(function(e){n[e]=t[e]});r=e[1]||{}}else if(_typeof(e[0])=="object"){n=e[0];r=e[1]||{}}else if(typeof e[0]=="string"){for(var s=0;s<e.length;s++){var o=e[s];if(typeof o=="string"){n[o]=t[o]}else if((typeof o==="undefined"?"undefined":_typeof(o))=="object"&&s==e.length-1){r=o}}}return{body:n,params:r}};Rest.VERSION="1.0.1";